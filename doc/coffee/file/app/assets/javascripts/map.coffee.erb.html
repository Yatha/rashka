<!DOCTYPE html>
<html>
  <head>
  <meta charset='UTF-8'>
  <title>CoffeeScript API Documentation</title>
  <script src='../../../../javascript/application.js'></script>
  <script src='../../../../javascript/search.js'></script>
  <link rel='stylesheet' href='../../../../stylesheets/application.css' type='text/css'>
</head>
  <body>
    <div id='base' data-path='../../../../'></div>
<div id='header'>
  <div id='menu'>
    <a href='../../../../extra/README.md.html' title='Rashka'>
      Rashka
    </a>
    &raquo;
    <a href='../../../../alphabetical_index.html' title='Index'>
      Index
    </a>
    &raquo;
    <span class='title'>app</span>
    &raquo;
    <span class='title'>assets</span>
    &raquo;
    <span class='title'>javascripts</span>
    &raquo;
    <span class='title'>map.coffee.erb</span>
  </div>
</div>
    <div id='content'>
      <h1>
        File:
        map.coffee.erb
      </h1>
      <table class='box'>
        <tr>
          <td>Defined in:</td>
          <td>app&#47;assets&#47;javascripts</td>
        </tr>
      </table>
      <h2>Variables Summary</h2>
      <dl class='constants'>
  <dt id='map-variable'>
    map
    =
  </dt>
  <dd>
    <pre><code class='coffeescript'>{

  &#47;*
  параметры карты
   *&#47;
  dom: document.getElementById(&quot;map-canvas&quot;),
  lastValidCenter: app.current_location,
  options: {
    center: app.current_location,
    disableDefaultUI: true,
    zoom: 13,
    minZoom: 4
  },
  show_places: function() {
    app.places.objects.forEach(places.get_distance);
    return app.places.objects.forEach(places.render);
  },
  set_current_location: function(location) {
    app.google_map.setCenter(location);
    app.current_location = location;
    return map.put_marker_on_current();
  },
  nav_geo_success: function(position) {
    var current_location;
    app.current_marker.setMap(null);
    if (app.directions_renderer !== void 0) {
      app.directions_renderer.setMap(null);

      &#47;*
      TODO: ресетить кнопку валить, раз уж мы на всякий стираем маршрут
       *&#47;
    }
    current_location = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
    map.set_current_location(current_location);
    return map.reset_markers();
  },
  nav_geo_error: function() {
    return console.log(&quot;Unable to retrieve your location&quot;);
  },
  get_current_location: function() {
    if (navigator.geolocation) {
      return navigator.geolocation.getCurrentPosition(map.nav_geo_success, map.nav_geo_error, {
        enableHighAccuracy: true
      });
    }
  },
  put_marker_on_current: function() {

    &#47;*
    добавляет маркер к текущему месту
     *&#47;
    var current_loc_marker_options;
    current_loc_marker_options = {
      position: app.current_location,
      icon: &quot;&lt;%= asset_path(&#39;current.jpg&#39;) %&gt;&quot;,
      map: app.google_map
    };
    return app.current_marker = new google.maps.Marker(current_loc_marker_options);
  },
  reset_markers: function() {
    app.places.objects.forEach(places.get_distance);
    return app.places.objects.forEach(places.update_infobox);
  },
  checkBounds: function() {

    &#47;*
    проверяет, вышел ли пользователь за пределы границ карты
     *&#47;
    if (app.bounds.contains(app.google_map.getCenter())) {
      map.lastValidCenter = app.google_map.getCenter();
    }
    return app.google_map.panTo(map.lastValidCenter);
  },
  cluster_markers: function() {

    &#47;*
    группирует маркеры вместе в один, если они рядом
     *&#47;
    var markerCluster_styles;
    markerCluster_styles = [
      {
        url: &quot;&lt;%= asset_path(&#39;current.jpg&#39;) %&gt;&quot;,
        height: 35,
        width: 35,
        textSize: 1
      }
    ];
    return new MarkerClusterer(app.google_map, app.markers, {
      styles: markerCluster_styles
    });
  },
  init: function() {

    &#47;*
    инициализация карты
     *&#47;
    app.google_map = new google.maps.Map(this.dom, this.options);
    return google.maps.event.addListener(app.google_map, &quot;center_changed&quot;, function() {
      return map.checkBounds();
    });
  }
}</code></pre>
    
  </dd>
  <dt id='places-variable'>
    places
    =
  </dt>
  <dd>
    <pre><code class='coffeescript'>{

  &#47;*
  параметры мест
   *&#47;
  types: {
    1: {
      icon: &quot;&lt;%= asset_path(&#39;places&#47;airplane.png&#39;) %&gt;&quot;
    },
    2: {
      icon: &quot;&lt;%= asset_path(&#39;places&#47;seaport.png&#39;) %&gt;&quot;
    },
    3: {
      icon: &quot;&lt;%= asset_path(&#39;places&#47;railway.png&#39;) %&gt;&quot;
    },
    4: {
      icon: &quot;&lt;%= asset_path(&#39;places&#47;border.png&#39;) %&gt;&quot;
    },
    5: {
      icon: &quot;&lt;%= asset_path(&#39;places&#47;car.png&#39;) %&gt;&quot;
    }
  },
  render: function(place) {

    &#47;*
    отображение места на карте, принимает json объект места
     *&#47;
    var marker, place_marker_options, position;
    position = new google.maps.LatLng(place.lat, place.lng);
    place_marker_options = {
      position: position,
      map: app.google_map,
      icon: places.types[place.type_id].icon
    };
    marker = new google.maps.Marker(place_marker_options);
    app.markers.push(marker);
    place.infobox = new InfoBox(app.infobox_options);
    places.update_infobox(place);
    google.maps.event.addListener(marker, &#39;mouseover&#39;, function() {
      return place.infobox.open(app.google_map, this);
    });
    return google.maps.event.addListener(marker, &#39;mouseout&#39;, function() {
      return place.infobox.close();
    });
  },
  update_infobox: function(place) {

    &#47;*
    устанавливает контент у инфобокса места
     *&#47;
    var infobox_content;
    infobox_content = &quot;&lt;p&gt;&lt;b&gt;&quot; + place.type + &quot; :&lt;&#47;b&gt; &quot; + place.name + &quot; &lt;&#47;p&gt; &lt;p&gt;&lt;b&gt;Расстояние:&lt;&#47;b&gt; &quot; + (place.distance.toFixed(1)) + &quot; км&lt;&#47;p&gt;&quot;;
    return place.infobox.setContent(infobox_content);
  },
  rad: function(x) {
    return x * Math.PI &#47; 180;
  },
  get_distance: function(place) {

    &#47;*
    добавляет значение расстояния от места до текущего положения, принимает json объект места
     *&#47;
    var a, c, cur_loc_lat, cur_loc_lng, dLat, dLong, earth_radius, place_lat, place_lng;
    cur_loc_lat = app.current_location.lat();
    cur_loc_lng = app.current_location.lng();
    earth_radius = 6371;
    place_lat = place.lat;
    place_lng = place.lng;
    dLat = places.rad(place_lat - cur_loc_lat);
    dLong = places.rad(place_lng - cur_loc_lng);
    a = Math.sin(dLat &#47; 2) * Math.sin(dLat &#47; 2) + Math.cos(places.rad(cur_loc_lat)) * Math.cos(places.rad(cur_loc_lat)) * Math.sin(dLong &#47; 2) * Math.sin(dLong &#47; 2);
    c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    place.distance = earth_radius * c;
    if (app.places.closest === void 0 || app.places.closest.distance &gt; place.distance) {
      return app.places.closest = place;
    }
  }
}</code></pre>
    
  </dd>
</dl>
    </div>
    <div id='footer'>
  February 17, 14 21:35:34 by
  <a href='https://github.com/coffeedoc/codo' title='CoffeeScript API documentation generator'>
    Codo
  </a>
  2.0.6
  &#10034;
  Press H to see the keyboard shortcuts
  &#10034;
  <a href='http://twitter.com/netzpirat' target='_parent'>@netzpirat</a>
  &#10034;
  <a href='http://twitter.com/_inossidabile' target='_parent'>@_inossidabile</a>
</div>
<iframe id='search_frame'></iframe>
<div id='fuzzySearch'>
  <input type='text'>
  <ol></ol>
</div>
<div id='help'>
  <p>
    Quickly fuzzy find classes, mixins, methods, file:
  </p>
  <ul>
    <li>
      <span>T</span>
      Open fuzzy finder dialog
    </li>
  </ul>
  <p>
    Control the navigation frame:
  </p>
  <ul>
    <li>
      <span>L</span>
      Toggle list view
    </li>
    <li>
      <span>C</span>
      Show class list
    </li>
    <li>
      <span>I</span>
      Show mixin list
    </li>
    <li>
      <span>F</span>
      Show file list
    </li>
    <li>
      <span>M</span>
      Show method list
    </li>
    <li>
      <span>E</span>
      Show extras list
    </li>
  </ul>
  <p>
    You can focus and blur the search input:
  </p>
  <ul>
    <li>
      <span>S</span>
      Focus search input
    </li>
    <li>
      <span>Esc</span>
      Blur search input
    </li>
  </ul>
</div>
  </body>
</html>